@model List<HaberPortali2.Models.AppUser>

@{
    ViewData["Title"] = "Kullanıcı Yönetimi";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";

    var adminIds = ViewBag.AdminIds as HashSet<int> ?? new();
    var authorIds = ViewBag.AuthorIds as HashSet<int> ?? new();
    var currentUserId = int.Parse(User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)!.Value);
}

<h3 class="fw-bold mb-4">👤 Kullanıcı Yönetimi</h3>

<table class="table table-bordered align-middle">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Ad Soyad</th>
            <th>Kullanıcı</th>
            <th>Email</th>
            <th style="width:340px;">Yetkiler</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var u in Model)
        {
            bool isAdmin = adminIds.Contains(u.Id);
            bool isAuthor = authorIds.Contains(u.Id);
            bool isSelf = u.Id == currentUserId;

            <tr>
                <td>@u.Id</td>
                <td>@u.FullName</td>
                <td>@u.UserName</td>
                <td>@u.Email</td>
                <td>
                    <form method="post" action="/Admin/User/ToggleRole" class="d-inline">
                        <input type="hidden" name="id" value="@u.Id" />
                        <input type="hidden" name="role" value="Admin" />
                        <button class="btn btn-sm @(isAdmin ? "btn-danger" : "btn-outline-danger")"
                                @(isSelf ? "disabled" : "")>
                            @(isAdmin ? "Admin Kaldır" : "Admin Yap")
                        </button>
                    </form>

                    <form method="post" action="/Admin/User/ToggleRole" class="d-inline ms-1">
                        <input type="hidden" name="id" value="@u.Id" />
                        <input type="hidden" name="role" value="Author" />
                        <button class="btn btn-sm @(isAuthor ? "btn-success" : "btn-outline-success")">
                            @(isAuthor ? "Yazar Kaldır" : "Yazar Yap")
                        </button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>
