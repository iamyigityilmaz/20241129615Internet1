@using HaberPortali2.Models
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";

    var lastNews = ViewBag.LastNews as List<News> ?? new List<News>();
    var lastComments = ViewBag.LastComments as List<Comment> ?? new List<Comment>();
}

<div class="container-fluid">

    <div class="row g-4 mb-4">

        <div class="col-md-3">
            <div class="card text-white bg-primary shadow-sm">
                <div class="card-body">
                    <h2 class="fw-bold">@ViewBag.TotalNews</h2>
                    <span>Toplam Haber</span>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-white bg-success shadow-sm">
                <div class="card-body">
                    <h2 class="fw-bold">@ViewBag.TotalCategories</h2>
                    <span>Toplam Kategori</span>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-white bg-secondary shadow-sm">
                <div class="card-body">
                    <h2 class="fw-bold">@ViewBag.TotalComments</h2>
                    <span>Toplam Yorum</span>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-white bg-warning shadow-sm">
                <div class="card-body">
                    <h2 class="fw-bold">@ViewBag.TodayComments</h2>
                    <span>Bugünkü Yorumlar</span>
                </div>
            </div>
        </div>

    </div>

    <div class="row g-4">

        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header fw-bold">📰 Son Eklenen Haberler</div>

                @if (!lastNews.Any())
                {
                    <div class="card-body text-muted">Henüz haber yok</div>
                }
                else
                {
                    <ul class="list-group list-group-flush">
                        @foreach (var n in lastNews)
                        {
                            <li class="list-group-item">
                                <div class="fw-bold">@n.Title</div>

                                <div class="small text-muted mb-2">
                                    @n.CreatedDate.ToString("dd.MM.yyyy") · @n.CreatedBy
                                </div>

                                <div class="d-flex gap-2">
                                    <a href="/News/Detail/@n.Id"
                                       class="btn btn-sm btn-outline-primary">
                                        Gör
                                    </a>

                                    <a href="/Admin/News/Edit/@n.Id"
                                       class="btn btn-sm btn-warning">
                                        Düzenle
                                    </a>

                                    <form method="post"
                                          action="/Admin/News/Delete"
                                          style="display:inline">
                                        <input type="hidden" name="id" value="@n.Id" />
                                        <button class="btn btn-sm btn-danger"
                                                onclick="return confirm('Haberi silmek istiyor musun?')">
                                            Sil
                                        </button>
                                    </form>
                                </div>
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header fw-bold">💬 Son Yorumlar</div>

                @if (!lastComments.Any())
                {
                    <div class="card-body text-muted">Henüz yorum yok</div>
                }
                else
                {
                    <ul class="list-group list-group-flush">
                        @foreach (var c in lastComments)
                        {
                            <li class="list-group-item">
                                <div class="fw-bold">@c.UserName</div>
                                <div class="small text-muted">
                                    @c.CreatedDate.ToString("dd.MM.yyyy HH:mm")
                                </div>

                                <div class="my-2">@c.Text</div>

                                <div class="d-flex gap-2">
                                    <a href="/News/Detail/@c.NewsId"
                                       class="btn btn-sm btn-outline-primary">
                                        Habere Git
                                    </a>

                                    <form method="post"
                                          action="/Admin/Comment/Delete">
                                        <input type="hidden" name="id" value="@c.Id" />
                                        <button class="btn btn-sm btn-danger"
                                                onclick="return confirm('Yorumu silmek istiyor musun?')">
                                            Sil
                                        </button>
                                    </form>
                                </div>
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>

</div>
