@model HaberPortali2.Models.News

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = Model.Title;
}

<div class="container mt-4">

    <!-- HABER BAŞLIĞI -->
    <h1 class="fw-bold mb-2">@Model.Title</h1>

    <!-- TARİH + KATEGORİ -->
    <p class="text-muted mb-3">
        @Model.CreatedDate.ToString("dd MMMM yyyy")
        ·
        <span class="badge bg-primary">@Model.Category?.Name</span>
    </p>

    <!-- HABER GÖRSELİ -->
    <img src="@(string.IsNullOrEmpty(Model.ImageUrl)
                                      ? "https://via.placeholder.com/800x400?text=Haber+Gorseli"
                                      : Model.ImageUrl)"
         class="img-fluid rounded shadow-sm mb-4"
         alt="Haber Görseli"
         style="max-height:450px; object-fit:cover;" />

    <!-- HABER İÇERİĞİ -->
    <div class="mt-3 fs-5" style="line-height:1.7;">
        @Html.Raw((Model.Content ?? "").Replace("\n", "<br/>"))
    </div>

    <hr class="my-4" />

    <!-- YORUMLAR BAŞLIK -->
    <h3 class="fw-bold mb-3">Yorumlar</h3>

    <div id="commentList" class="mb-4"></div>

    <hr />

    <!-- YORUM FORMU -->
    <h4 class="fw-bold mb-3">Yorum Yap</h4>

    <!-- ❗️ Kullanıcı Adı KALDIRILDI! -->
    <div class="mb-3">
        <label class="form-label fw-semibold">Yorumunuz</label>
        <textarea id="commentText" class="form-control" rows="3" placeholder="Yorumunuzu yazın"></textarea>
    </div>

    <button class="btn btn-primary px-4" id="btnSend">Gönder</button>

</div>

<!-- JQUERY -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

    // -----------------------------
    // YORUMLARI YÜKLE
    // -----------------------------
    function loadComments() {
        $("#commentList").load("/Comment/GetComments?newsId=@Model.Id");
    }

    loadComments();

    // -----------------------------
    // YORUM GÖNDER
    // -----------------------------
    $("#btnSend").click(function () {

        const comment = $("#commentText").val().trim();

        if (comment.length < 3) {
            alert("Lütfen daha uzun bir yorum yazın.");
            return;
        }

        $.post("/Comment/AddComment",
            {
                newsId: @Model.Id,
                text: comment    // ❗ userName gönderilmiyor
            },
            function (response) {
                if (response.success) {

                    $("#commentText").val("");
                    loadComments();
                }
                else {
                    alert(response.message);
                }
            });
    });

</script>
